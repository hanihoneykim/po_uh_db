{% extends 'common.html' %}
{% block content %}
            <div id="layoutSidenav_content">
                <main>
                    <div class="container-fluid px-4">
                        <h2 class="mt-4">
                            고객 조회
                        </h2>
                        
                        <div class="row mt-4">
                            <!-- 1번칸 -->
                            <div class="col-md-6">
                                <!-- 고객 정보 -->
                                <div class="card mb-4" style="height: 100%;">
                                    <div class="card-header">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <i class="fas fa-table me-1"></i>
                                                고객 정보
                                            </div>
                                            <a data-toggle="modal" data-target="#modifyGuestModal" class="btn btn-dark align-items-center" style="margin-right: 10px; height: 40px; color: white;">고객 정보 수정</a>
                                        </div>
                                    </div>
                                    <div class="card-body row mt-4">
                                        <div class="col-md-2 mr-4">
                                            <!-- 항목 부분 -->
                                            <div style="text-align: right;">
                                                <p style="font-size: 15px; margin-bottom: 20px;">고객명 </p>
                                                <p style="font-size: 15px; margin-bottom: 20px;">연락처 </p>
                                                <p style="font-size: 15px; margin-bottom: 20px;">생년월일 </p>
                                                <p style="font-size: 15px; margin-bottom: 21px;">개인/기업 </p>
                                                <p style="font-size: 15px; margin-bottom: 21px;">이메일 </p>
                                                <p style="font-size: 15px; margin-bottom: 21px;">카드번호 </p>
                                                <p style="font-size: 15px; margin-bottom: 21px;">국적 </p>
                                                <p style="font-size: 15px; margin-bottom: 21px;">직업 </p>
                                            </div>
                                        </div>
                                        <div class="col-md-9">
                                            <!-- 인풋 부분 -->
                                            <div style="height: 100%;">
                                                <p style="margin-bottom: -5px; font-size: 15px; margin-left: -20px;">{{ guest.guest_name }}</p><br>
                                                <p style="margin-bottom: -3px; font-size: 15px; margin-left: -20px;">{{ guest.phone_number }}</p><br>
                                                <p style="margin-bottom: -3px; font-size: 15px; margin-left: -20px;">{{ guest.date_of_birth }}</p><br>
                                                <p style="margin-bottom: -3px; font-size: 15px; margin-left: -20px;">{{ guest.guest_type }}</p><br>
                                                <p style="margin-bottom: -3px; font-size: 15px; margin-left: -20px;">{{ guest.email }}</p><br>
                                                <p style="margin-bottom: -3px; font-size: 15px; margin-left: -20px;">{{ guest.credit_card_number }}</p><br>
                                                <p style="margin-bottom: -3px; font-size: 15px; margin-left: -20px;">{{ guest.nationality }}</p><br>
                                                <p style="margin-bottom: 0px; font-size: 15px; margin-left: -20px;">{{ guest.job }}</p><br>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- 2번칸 -->
                            <div class="col-md-6">
                                <div class="row">
                                    <!-- 2-1번칸 -->
                                    <div class="col-md-12 mb-3">
                                        <!-- 고객 통계 -->
                                        <div class="card">
                                            <div class="card-header">
                                                <i class="fas fa-chart-bar me-1"></i>
                                                고객 통계
                                            </div>
                                            <div class="card-body p-4">
                                                <div class="row justify-content-center" style="height: 100%;">
                                                    <!-- 첫 번째 칸 -->
                                                    <div class="col-md-5 mb-3">
                                                        <div class="row p-3 align-items-center">
                                                            <!-- 첫 번째 칸 내용 -->
                                                            <h5>총 방문 횟수 :</h5>
                                                            <span style="color:green; font-size: 30px; font-weight: bold;">{{ guest.visit_count }}</span>
                                                        </div>
                                                    </div>
                                                    <!-- 세로 선 -->
                                                    <div class="col-md-1 mb-3" style="border-left: 1px solid rgba(0,0,0,0.5); height: 100px;"></div>
                                                    <!-- 두 번째 칸 -->
                                                    <div class="col-md-5 mb-3">
                                                        <div class="row p-3 align-items-center">
                                                            <!-- 두 번째 칸 내용 -->
                                                            <h5>가장 많이 방문한 지점 :</h5>
                                                            <span style="color:green; font-size: 25px; font-weight: bold;">THE MYEONGDONG</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- 2-2번칸 -->
                                    <div class="col-md-12">
                                        <!-- 고객 메모 -->
                                        <div class="card" style="height: 100%;">
                                            <div class="card-header">
                                                <i class="fas fa-sticky-note me-1"></i>
                                                고객 메모
                                            </div>
                                            <div class="card-body p-4" style="height: 100%; overflow-y: auto;">
                                                <span>{{ guest.memo }}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card mb-4 mt-3">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <div>
                                <i class="fas fa-table me-1"></i>
                                    고객 예약 조회
                                </div>
                            </div>
                            <div class="card-body p-4">
                                <div style="overflow-x: auto;">
                                    <div class="table-responsive my-4">
                                        <table class="table table-bordered display" id="dataTables" width="100%" cellspacing="0">
                                            <thead>
                                                <tr>
                                                    <th style="white-space: nowrap;">건물</th>
                                                    <th style="white-space: nowrap;">방타입</th>
                                                    <th style="white-space: nowrap;">예약자 성함</th>
                                                    <th style="white-space: nowrap;">플랫폼</th>
                                                    <th style="white-space: nowrap;">예약날짜</th>
                                                    <th style="white-space: nowrap;">리드타임</th>
                                                    <th style="white-space: nowrap;">체크인</th>
                                                    <th style="white-space: nowrap;">체크아웃</th>
                                                    <th style="white-space: nowrap;">숙박일</th>
                                                    <th style="white-space: nowrap;">숙박비</th>
                                                    <th style="white-space: nowrap;">ADR</th>
                                                    <th style="white-space: nowrap;">국적</th>
                                                    <th style="white-space: nowrap;">투숙인원</th>
                                                    <th style="white-space: nowrap;">관계</th>
                                                    <th style="white-space: nowrap;">투숙/취소</th>
                                                    <th style="white-space: nowrap;">미성년자</th>
                                                    <th style="white-space: nowrap;">연락처</th>
                                                    <th style="white-space: nowrap;">이메일</th>
                                                    <th style="white-space: nowrap;">비고</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for item in guest_reservations %}
                                                    <tr onclick="window.location='/the-myeongdong/reservations/{{ item.id }}';" style="cursor: pointer;">
                                                        <td style="white-space: nowrap;">{{ item.building_location }}</td>
                                                        <td style="white-space: nowrap;">{{ item.room_type }}</td>
                                                        <td style="white-space: nowrap;">{{ item.guest_name }}</td>
                                                        <td style="white-space: nowrap;">{{ item.platform_name }}</td>
                                                        <td style="white-space: nowrap;">{{ item.reservation_date }}</td>
                                                        <td style="white-space: nowrap;">{{ item.lead_time }}</td>
                                                        <td style="white-space: nowrap;">{{ item.check_in_date }}</td>
                                                        <td style="white-space: nowrap;">{{ item.check_out_date }}</td>
                                                        <td style="white-space: nowrap;">{{ item.lenth_of_stay }}</td>
                                                        <td style="white-space: nowrap;">{{ item.total_room_charge }}</td>
                                                        <td style="white-space: nowrap;">{{ item.adr}}</td>
                                                        <td style="white-space: nowrap;">{{ item.nationality }}</td>
                                                        <td style="white-space: nowrap;">{{ item.guest_count }}</td>
                                                        <td style="white-space: nowrap;">{{ item.relationship }}</td>
                                                        <td style="white-space: nowrap;">{{ item.is_checked_in }}</td>
                                                        <td style="white-space: nowrap;">{{ item.is_minor }}</td>
                                                        <td style="white-space: nowrap;">{{ item.phone_number }}</td>
                                                        <td style="white-space: nowrap;">{{ item.email }}</td>
                                                        <td style="white-space: nowrap;">{{ item.remarks|truncatechars:30 }}</td>
                                                    </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </main>


<!-- Modal -->
<div class="modal fade" id="modifyGuestModal" tabindex="-1" role="dialog" aria-labelledby="detailModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-md" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <span style="font-size: 20px; font-weight: bold; margin-right: 20px;">고객 상세 조회</span>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body mb-3 ml-3 mt-3">
                <div class="row">
                    <div class="col-md-3 mr-3">
                        <!-- 항목 부분 -->
                        <div style="text-align: right;">
                            <p style="font-size: 13px; margin-bottom: 20px;">고객명 </p>
                            <p style="font-size: 13px; margin-bottom: 20px;">연락처 </p>
                            <p style="font-size: 13px; margin-bottom: 20px;">생년월일 </p>
                            <p style="font-size: 13px; margin-bottom: 21px;">개인/기업 </p>
                            <p style="font-size: 13px; margin-bottom: 21px;">이메일 </p>
                            <p style="font-size: 13px; margin-bottom: 21px;">카드번호 </p>
                            <p style="font-size: 13px; margin-bottom: 21px;">국적 </p>
                            <p style="font-size: 13px; margin-bottom: 21px;">직업 </p>
                            <p style="font-size: 13px; margin-bottom: 21px;">메모 </p>
                        </div>
                    </div>
                    <div class="col-md-8">
                        <!-- 인풋 부분 -->
                        <div>
                            <input id="guestNameInput" style="width: 250px; height: 30px; margin-bottom: 10px; margin-left: -20px; font-size: 13px;" placeholder="고객명" value="{{ guest.guest_name }}"><br>
                            <input id="phoneNumberInput" style="width: 250px; margin-bottom: 10px; height: 30px; margin-left: -20px; font-size: 13px;" placeholder="연락처" value="{{ guest.phone_number }}"><br>
                            <input id="dateOfBirthInput" style="width: 250px; margin-bottom: 10px; height: 30px; margin-left: -20px; font-size: 13px;" placeholder="생년월일" value="{{ guest.date_of_birth }}"><br>
                            <div style="margin-left: -20px; margin-bottom: 10px;">
                                <select id="guestTypeDropdown" style="font-size: 13px; font-weight: 300; width: 250px; height: 30px;">
                                    <option value="individual" {% if guest.guest_type == "individual" %} selected {% endif %}>개인</option>
                                    <option value="corporate" {% if guest.guest_type == "corporate" %} selected {% endif %}>법인</option>
                                    <option value="all">전체</option>
                                </select>
                            </div>
                            <input id="emailInput" style="margin-bottom: 10px; width: 250px; height: 30px; font-size: 13px; margin-left: -20px;" placeholder="이메일" value="{{ guest.email }}"><br>
                            <input id="creditCardInput" style="margin-bottom: 10px; width: 250px; height: 30px; font-size: 13px; margin-left: -20px;" placeholder="카드번호" value="{{ guest.credit_card_number }}"><br>
                            <input id="nationalityInput" style="margin-bottom: 10px; width: 250px; height: 30px; font-size: 13px; margin-left: -20px;" placeholder="국적" value="{{ guest.nationality }}"><br>
                            <input id="jobInput" style="margin-bottom: 10px; width: 250px; height: 30px; font-size: 13px; margin-left: -20px;" placeholder="직업" value="{{ guest.job }}"><br>
                            <textarea id="memoInput" style="margin-bottom: 10px; width: 250px; height: 200px; font-size: 13px; margin-left: -20px; white-space: pre-wrap; overflow-y: auto;">{{ guest.memo }}</textarea><br>

                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="saveGuestInfoButton" type="button" class="btn btn-secondary" data-dismiss="modal">저장</button>
            </div>
        </div>
    </div>
</div>


<script>
    // 문서가 로드된 후 실행되는 함수
    document.addEventListener('DOMContentLoaded', function() {
        // 고객 상세 조회 버튼 요소를 찾습니다.
        var detailGuestButton = document.querySelector('[data-target="#modifyGuestModal"]');

        // 고객 상세 조회 버튼이 클릭되었을 때 실행될 함수를 정의합니다.
        detailGuestButton.addEventListener('click', function() {
            // 모달을 보이도록 설정합니다.
            var modal = document.querySelector('#modifyGuestModal');
            modal.style.display = 'block';
        });
    });
</script>



<script>
    $(document).ready(function() {
        $('#reservationDateSearch').datepicker({
            language: "ko",
            autoclose: true,
            todayHighlight: true
        })
    })

    $(document).ready(function() {
        $('#checkInDateSearch').datepicker({
            language: "ko",
            autoclose: true,
            todayHighlight: true
        })
    })

    $(document).ready(function() {
        $('#checkOutDateSearch').datepicker({
            language: "ko",
            autoclose: true,
            todayHighlight: true
        })
    })
</script>
<script>
    function formatAccommodationFee(input) {
        // 입력값에서 쉼표를 제거하고 숫자만 남깁니다.
        let value = input.value.replace(/[^0-9]/g, '');
        // 숫자를 오른쪽에서부터 왼쪽으로 3자리씩 쉼표로 구분합니다.
        value = value.replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        // 포맷팅된 값으로 입력 필드의 값을 업데이트합니다.
        input.value = value;
    }
</script>
<!-- <script>
    $(document).ready(function() {
    $('#saveGuestInfoButton').click(function() {
        // 모달 내의 입력값을 가져옵니다.
        var guestName = $('#guestNameInput').val();
        var phoneNumber = $('#phoneNumberInput').val();
        var dateOfBirth = $('#dateOfBirthInput').val();
        var guestType = $('#guestTypeDropdown').val();
        var email = $('#emailInput').val();
        var creditCard = $('#creditCardInput').val();
        var nationality = $('#nationalityInput').val();
        var job = $('#jobInput').val();
        var memo = $('#memoInput').val();

        // PUT 요청을 위한 데이터 객체 생성
        var data = {
            "guest_name": guestName,
            "phone_number": phoneNumber,
            "date_of_birth": dateOfBirth,
            "guest_type": guestType,
            "email": email,
            "credit_card_number": creditCard,
            "nationality": nationality,
            "job": job,
            "memo": memo
        };
        // AJAX 요청을 보내기 전에 CSRF 토큰을 가져옵니다.
        var csrftoken = getCookie('csrftoken');

        // AJAX를 사용하여 PUT 요청을 보냅니다.
        $.ajax({
            url: '/guest_inquiry/{{ guest.id }}', // 수정할 고객의 API 엔드포인트
            type: 'PUT',
            contentType: 'application/json',
            data: JSON.stringify(data),
            success: function(response) {
                // 성공적으로 업데이트되면 모달을 닫습니다.
                $('#modifyGuestModal').modal('hide');
                // 페이지 새로고침 또는 업데이트된 정보를 반영하는 다른 작업을 수행할 수 있습니다.
            },
            error: function(xhr, status, error) {
                // 오류 처리
                console.error(xhr.responseText);
            }
        });

        // 쿠키에서 CSRF 토큰을 가져오는 함수
        function getCookie(name) {
            var cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                var cookies = document.cookie.split(';');
                for (var i = 0; i < cookies.length; i++) {
                    var cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
    });
}); -->

</script>
{% endblock %}
